<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Omni V8.5 - Ghost UI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --bg: #0c0c0d; --accent: #00f2ff; --text: #e3e3e3; --mood-color: #00f2ff; --glass: rgba(30, 31, 32, 0.9); }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        
        /* Setting Button - Kone mein */
        #settings-trigger { position: fixed; top: 20px; right: 20px; font-size: 24px; cursor: pointer; z-index: 100; opacity: 0.6; transition: 0.3s; }
        #settings-trigger:hover { opacity: 1; transform: rotate(45deg); }

        /* Hidden Settings Panel */
        #settings-panel { position: fixed; top: 70px; right: 20px; background: var(--glass); border: 1px solid #333; padding: 20px; border-radius: 15px; width: 250px; display: none; backdrop-filter: blur(10px); z-index: 99; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn-small { background: #333; border: 1px solid #444; color: #ccc; font-size: 11px; padding: 10px; cursor: pointer; border-radius: 5px; width: 100%; margin-top: 10px; }
        
        /* Main View */
        #main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; background: radial-gradient(circle at center, #111 0%, #000 100%); }
        .mood-glow { position: absolute; width: 450px; height: 450px; background: var(--mood-color); filter: blur(120px); opacity: 0.1; border-radius: 50%; pointer-events: none; transition: 0.8s; }
        
        /* Response Box */
        #response-box { background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 30px; text-align: center; color: var(--accent); font-size: 18px; max-width: 80%; min-height: 40px; transition: 0.3s; }

        /* Avatar */
        .shadow-circle { width: 260px; height: 260px; border-radius: 50%; border: 2px solid var(--mood-color); display: flex; align-items: center; justify-content: center; transition: 0.5s; box-shadow: 0 0 20px rgba(0,242,255,0.2); }
        .avatar-img { width: 230px; height: 230px; border-radius: 50%; object-fit: cover; transition: 0.5s; }
        
        /* Input Area (Centered Bottom) */
        #input-container { padding: 40px 10%; width: 100%; box-sizing: border-box; }
        .input-wrapper { max-width: 600px; margin: 0 auto; background: var(--glass); border-radius: 40px; display: flex; align-items: center; padding: 5px 20px; border: 1px solid #333; }
        input { flex: 1; background: transparent; border: none; color: white; padding: 15px; outline: none; font-size: 16px; }

        /* Animations */
        .talking { animation: vibrate 0.2s infinite; border-width: 4px; }
        @keyframes vibrate { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        
        .anger-mode { animation: shake 0.15s infinite; border-color: #ff4b2b !important; box-shadow: 0 0 40px #ff4b2b !important; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -2px); } 100% { transform: translate(1px, -1px); } }
        
        .happy-mode { animation: breathe 2.5s ease-in-out infinite; border-color: #f9d423 !important; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
        
        #thought-process { font-size: 12px; color: #666; margin-bottom: 10px; font-style: italic; min-height: 15px; }
    </style>
</head>
<body>

<div id="settings-trigger" onclick="toggleSettings()">‚öôÔ∏è</div>

<div id="settings-panel">
    <h4 style="margin:0 0 10px 0; color:var(--accent);">Settings</h4>
    <input type="password" id="masterKey" placeholder="Master Key..." style="width:100%; background:#000; color:white; border:1px solid #444; padding:8px; border-radius:4px; box-sizing:border-box;" oninput="ShadowOmni.loadMemory()">
    <div id="auth-status" style="font-size:10px; color:#ffb700; margin-top:5px;">üîí Locked</div>
    
    <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
    
    <button class="btn-small" onclick="exportBrain()">üì• Export Brain</button>
    <button class="btn-small" onclick="document.getElementById('imp').click()">üì§ Import Brain</button>
    <input type="file" id="imp" style="display:none" onchange="importBrain(event)">
    <button class="btn-small" onclick="ShadowOmni.wipe()" style="color:#ff6b6b; border-color:#522;">‚ö†Ô∏è Wipe Data</button>
    
    <div style="font-size:10px; color:#666; margin-top:10px; text-align:center;">
        Memory: <span id="mem-count">0</span> Keys
    </div>
</div>

<div id="main">
    <div class="mood-glow" id="glow"></div>
    <div id="thought-process"></div>
    <div id="response-box">"Master, settings are now hidden."</div>
    <div class="shadow-circle" id="circle">
        <img src="https://cdn-icons-png.flaticon.com/512/4140/4140047.png" class="avatar-img" id="avatar">
    </div>
</div>

<div id="input-container">
    <div class="input-wrapper">
        <button style="background:none; border:none; cursor:pointer;" onclick="startVoice()">üéôÔ∏è</button>
        <input type="text" id="userInput" placeholder="Sikho (key | res) ya Poocho..." onkeypress="if(event.key==='Enter') handleUI()">
        <button style="background:none; border:none; cursor:pointer; color:var(--accent);" onclick="handleUI()">‚û§</button>
    </div>
</div>

<script>
const ShadowOmni = {
    memory: {}, context: [],
    moodMap: { anger: "#ff4b2b", happy: "#f9d423", cool: "#00f2ff", neutral: "#00f2ff" },

    loadMemory: function() {
        const pass = document.getElementById('masterKey').value;
        const data = localStorage.getItem('shadow_brain_enc');
        if (!data) return;
        try {
            const bytes = CryptoJS.AES.decrypt(data, pass);
            const dec = bytes.toString(CryptoJS.enc.Utf8);
            this.memory = JSON.parse(dec);
            document.getElementById('auth-status').innerText = "üîì Unlocked";
            document.getElementById('mem-count').innerText = Object.keys(this.memory).length;
        } catch (e) { document.getElementById('auth-status').innerText = "‚ùå Locked"; }
    },

    sync: function() {
        const pass = document.getElementById('masterKey').value;
        if (!pass) return;
        const enc = CryptoJS.AES.encrypt(JSON.stringify(this.memory), pass).toString();
        localStorage.setItem('shadow_brain_enc', enc);
        document.getElementById('mem-count').innerText = Object.keys(this.memory).length;
    },

    findFuzzy: function(q) {
        let query = q.toLowerCase().trim();
        // Self-Correction Logic
        if ((query.includes("‡§ó‡§≤‡§§") || query.includes("wrong")) && this.context.length > 0) {
            return "correct_mode";
        }
        if (this.memory[query]) return this.memory[query];
        for (let key in this.memory) {
            if (query.includes(key) || key.includes(query)) return this.memory[key];
        }
        return null;
    },

    // Shadow Sense Logic
    applyTimeMood: function() {
        const hr = new Date().getHours();
        const glow = document.getElementById('glow');
        if (hr >= 22 || hr < 5) {
            document.documentElement.style.setProperty('--mood-color', '#1a1a2e');
            return "‡§∂‡§æ‡§Ç‡§§ ‡§î‡§∞ ‡§ó‡§Ç‡§≠‡•Ä‡§∞";
        } else if (hr >= 6 && hr < 12) {
            document.documentElement.style.setProperty('--mood-color', '#f0a500');
            return "‡§ä‡§∞‡•ç‡§ú‡§æ‡§µ‡§æ‡§®";
        }
        return "‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø";
    },

    bol: function(t, mood = 'neutral') {
        document.getElementById('response-box').innerText = t;
        const circle = document.getElementById('circle');
        
        // Emotion Expression Logic
        circle.classList.remove('anger-mode', 'happy-mode');
        if(mood === 'anger') circle.classList.add('anger-mode');
        if(mood === 'happy') circle.classList.add('happy-mode');

        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'hi-IN';
        m.onstart = () => circle.classList.add('talking');
        m.onend = () => circle.classList.remove('talking');
        window.speechSynthesis.speak(m);
    },

    wipe: function() { if(confirm("Sab delete kar doon?")) { localStorage.clear(); location.reload(); } }
};

function toggleSettings() {
    const panel = document.getElementById('settings-panel');
    panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
}

// Chain of Thought & Context Memory Handling
async function handleUI() {
    const i = document.getElementById('userInput');
    const val = i.value.trim();
    const thoughtBox = document.getElementById('thought-process');
    if (!val) return;

    if (val.includes("|")) {
        let p = val.split("|").map(s => s.trim().toLowerCase());
        if (!ShadowOmni.memory[p[0]]) ShadowOmni.memory[p[0]] = [];
        ShadowOmni.memory[p[0]].push({ text: p[1], mood: p[2] || 'neutral' });
        ShadowOmni.sync();
        ShadowOmni.bol("Sikh liya, Master.", 'happy');
    } else {
        // Multi-Step Chain of Thought
        thoughtBox.innerText = "Shadow is thinking...";
        await new Promise(r => setTimeout(r, 600));
        
        const timeMood = ShadowOmni.applyTimeMood();
        thoughtBox.innerText = `Sense: ${timeMood} | Memory Connection: Active...`;
        await new Promise(r => setTimeout(r, 400));

        let res = ShadowOmni.findFuzzy(val);

        // Self-Correction Trigger
        if (res === "correct_mode") {
            ShadowOmni.bol("‡§Æ‡§æ‡•û ‡§ï‡§∞‡§®‡§æ ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞, ‡§∏‡§π‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à? (key | value ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡§ø‡§ñ‡§æ‡§è‡§Ç)");
            thoughtBox.innerText = "";
            i.value = "";
            return;
        }

        // Persistent Contextual Memory Logic
        if (!res && val.includes("‡§ñ‡§æ") && ShadowOmni.context.some(c => c.includes("‡§≠‡•Ç‡§ñ"))) {
            ShadowOmni.bol("‡§Ü‡§™‡§®‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡§π‡§æ ‡§•‡§æ ‡§≠‡•Ç‡§ñ ‡§≤‡§ó‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§ï‡•Å‡§õ ‡§≠‡§æ‡§∞‡•Ä ‡§ñ‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§", 'neutral');
        } else if (res) {
            const finalRes = res[res.length-1];
            ShadowOmni.bol(finalRes.text, finalRes.mood);
        } else {
            ShadowOmni.bol("Ye yaad nahi hai.");
        }
        
        // Save to context
        ShadowOmni.context.push(val);
        if(ShadowOmni.context.length > 5) ShadowOmni.context.shift();
        
        thoughtBox.innerText = "";
    }
    i.value = "";
}

function startVoice() {
    const r = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    r.lang = 'hi-IN';
    r.onresult = (e) => { document.getElementById('userInput').value = e.results[0][0].transcript; handleUI(); };
    r.start();
}

function exportBrain() {
    const d = localStorage.getItem('shadow_brain_enc');
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([d], {type: "text/plain"}));
    a.download = "shadow_brain.txt";
    a.click();
}

function importBrain(e) {
    const r = new FileReader();
    r.onload = (ev) => { localStorage.setItem('shadow_brain_enc', ev.target.result); location.reload(); };
    r.readAsText(e.target.files[0]);
}
</script>
</body>
</html>
